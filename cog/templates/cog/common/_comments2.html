<!--// START: /cog/templates/cog/common/_comments.html //-->

<!-- 
    Django template snippet to render comments for an object
    object: the object the comments refer to
    next_view; the URL of the view to forward to after saving the comment
-->

{% load comments %}
{% load pagination_tags %}
{% load cog_utils %}

{% get_comment_count for object as comment_count %}
{% get_comment_list for object as comment_list %}
{% autopaginate comment_list 10 %}

<hr class="white"/>

{% for comment in comment_list %}
	<div class="mybox">
	   <div id="comment_{{ comment.id }}" class="box-comment2">
	       <div class="caption">
	       		{{ comment.name|escape }}, on {{ comment.submit_date }}
	       		<!-- comments can only be deleted by the original authors, or project administrators -->
	       		{% if request.user == comment.user or request.user|hasAdminPermission:comment.content_object.project %}
		       		<span style='float:right'>
		       			<a class="deletelink" 
		       				onclick="return urlConfirmationDialog('Delete Comment Confirmation','Are you sure you want to delete this comment ?',this)"
		       				href="{% url 'delete_comment' comment.id %}?next={{request.path}}">Delete</a>
		       		</span>
	       		{% endif %}
	       </div>
	       <div class="body">
	       		<table>
	       			<tr>
	       				<td>
	       					<img src="{{ comment.user|getImage }}" {% if comment.user.profile.image %} class="myimage" {% endif %} style="width:35px;"/>
	       				</td>
	       				<td class="long">
	       					{{ comment.comment|escape|urlizetrunc:40|linebreaksbr }}
	       				</td>
	       			</tr>
	       		</table>
	       </div>
	   </div><!--// end div id=comment_ //-->
	</div>
{% endfor %}

{% paginate %}
		
<!-- only authenticated users can comment -->
{% if request.user|hasUserPermission:project %}
	{% get_comment_form for object as form %}
	<form action="{% comment_form_target %}" method="post">
	    {{ form.content_type }}
	    {{ form.object_pk }}
	    {{ form.timestamp }}
	    {{ form.security_hash }}
	    {% csrf_token %} 
	    <p style="display:none"><label for="id_honeypot">Leave blank</label>{{ form.honeypot }}</p>
	    <input type="hidden" name="next" value="{{ next_view }}"/>
	    <!--add the plus sign icon-->
	    <label for="id_comment">
            <span style="margin-left:4px; font-size:11px; vertical-align: middle;" class="addlink"> New Post:</span>
        </label>
        <textarea style="margin-left:4px;margin-top:4px; width:98%;" name="comment" id="id_comment" rows="6" cols="30"></textarea>
	    <br>
	    <input style="margin-left:4px;" type="submit" name="post" value="Post" />
	</form>
{% else %}
	You must 
	{% if user.is_anonymous %}
	<a href="{% url 'login' %}?next={{ request.path }}">login</a> and
	{% endif %}
	<a href="{% url 'membership_request' project.short_name|lower %}">join the {{ project.short_name }} project</a>
	to post to this thread.
{% endif %}

</div> <!--// end div id=mycomments //-->

<!--// END: /cog/templates//cog/common/_comments.html //-->
