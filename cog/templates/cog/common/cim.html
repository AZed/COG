<!-- jsCIM external dependencies -->
<link href="{{ STATIC_URL }}cog/jquery/css/jquery-ui/redmond/jquery-ui-1.8.6.custom.css" media="screen" rel="stylesheet" type="text/css" />

<!-- Custom JS to invoke the CIM viewer -->
<script language="JavaScript">

        /* only load these links if the ES-DOC functionality is needed */
        var JS_PATH     = "http://purl.org/org/es-doc/prod/plugins/jscim-min.js";
        var CSS_PATH    = "http://purl.org/org/es-doc/prod/plugins/jscim-min.css";
        var LOADED_EXTERNAL_LINKS = 0;

        /* loads the CIM libraries only once */
        /* runs a callback_fn _after_ the libraries have loaded */
        function load_cim_libraries(callback_fn) {

            if (LOADED_EXTERNAL_LINKS==0) {

                var js_link = document.createElement("script");
                js_link.setAttribute("type","text/javascript");
                js_link.setAttribute("src",JS_PATH);

                var css_link = document.createElement("link");
                css_link.setAttribute("type","text/css");
                css_link.setAttribute("rel","stylesheet");
                css_link.setAttribute("media","screen");
                css_link.setAttribute("href",CSS_PATH)

                var first_script = document.getElementsByTagName("script")[0]
                if (callback_fn) {
                    js_link.addEventListener("load",
                        function() {
                            callback_fn();
                        },
                        false);
                }
                first_script.parentNode.insertBefore(css_link,first_script);
                first_script.parentNode.insertBefore(js_link,first_script);

                LOADED_EXTERNAL_LINKS=1;

            }
            else if (callback_fn) {
                callback_fn();
            }
            
        }

	// function triggered by clicking on a CIM dataset link
	function onDatasetClicked(project, dataset) {
            load_cim_libraries(function() {
                cim.viewer.renderFromExternalID( {
                    project : project,
                    externalID : dataset,
                    externalType : 'dataset'
		});
            });
	}

	// function triggered by clicking on a CIM model link
	function onModelClicked(project, model) {
            load_cim_libraries(function() {
                cim.viewer.renderFromName( {
                    project : project,
                    name : model,
                    type : 'model'
                });
            });
	}

	<!-- FIXME -->
	// function triggered by CIM link
	function onCIMLinkClicked(project, institute, model, experiment) {
            load_cim_libraries(function() {
                var drs_components = {'project' : project, 'institute' : institute, 'model' : model, 'experiment' : experiment};
                cim.viewer.renderFromDRS(drs_components);
            });
	}


</script>
