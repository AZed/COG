{% extends "cog/common/layout_sidebar_center.html" %}

{% block main %}

    {% load comments %}
    {% load pagination_tags %}
    {% autopaginate topics 10 %}
    {% load cog_utils %}
    
    <!-- table of forum topics/threads -->
    <div class="mybox">
	    <table>
	        <caption>{{ project.short_name }} Forum Topics</caption>
    
    		{% if topics %}
	    		<!-- loop over forum topics -->
	    		{% for topic in topics %}
	    			<tr>
	    				<td>
	    					<b>{{ topic.title  }}</b>
	    					<br/>{{ topic.description  }}
	    				</td>
	    				<td>
	    					{% if topic.threads %}
	    						{% for thread in topic.get_threads %}
	    							{{ thread.subtitle }}
	    						{% endfor %}
	    					{% else %}
	    						<i>This topic has no threads yet.</i>
	    					{% endif %}
	    				</td>
	    			</tr>
	    		{% endfor %}
	    	{% else %}
	    		<tr>
	    			<td><i>This forum has no topics yet.</i></td>
	    		</tr>
	    	{% endif %}
    
		</table>
	</div>

	{% paginate %}
		
	&nbsp;
	<hr/>
	<!-- new forum topic form -->
	{% if user|hasAdminPermission:project %}
	  	<form action="" method="post">
		    {% csrf_token %}	
			<table>
				<tr>
					<td nowrap="nowrap">
						<span style="vertical-align: middle">Start a new <b>Topic</b>:</span>
					</td>
					<td class="long">{{ form.title }} {{ form.title.errors }}</td>
				</tr>
				<tr>
					<td nowrap="nowrap">Optional description:</td>
					<td> {{ form.description }} {{ form.description.errors }}</td>
				</tr>
				<tr>
					<td>&nbsp;</td>
					<td style="vertical-align: middle">
						{{ form.is_private }} This topic is private (can only be viewed by project members)
						&nbsp;<input type="submit" value="Submit"/>
					</td>
				</tr>
			</table>
	  	</form>
	  	
	  	Forum topics can only be created by project administrators. 
		The topic title and description must not contain special characters.
	{% endif %}
	
{% endblock %}