{% extends "cog/common/layout_sidebar_center.html" %}

{% block main %}

    {% load comments %}
    {% load pagination_tags %}
    {% autopaginate threads 10 %}
    
     <div class="mybox">
	    <table>
	        <caption>{{ project.short_name }} Forum Discussions</caption>
    
    		{% if threads %}
	    		<!-- loop over forum threads -->
	    		{% for thread in threads %}
	    			{% get_comment_count for thread as comment_count %}
	    			<tr>
	    				<td>{{ page_obj.start_index|add:forloop.counter|add:-1}}</td>
	    				<td>
	    					<b><a href="{% url 'thread_detail' project.short_name thread.id %}">{{ thread.title }}</a></b>
	    					<hr/>
	    					Started by {{ thread.author }} on {{ thread.create_date }}, 
	    					           {{ comment_count }} comments, last comment on ... by ...
	    				</td>
	    			</tr>
	    		{% endfor %}
	    	{% else %}
	    		<tr>
	    			<td>This forum has no threads yet.</td>
	    		</tr>
	    	{% endif %}
    
		</table>
	</div>

	{% paginate %}
	
	<hr/>		
	<!-- new forum thread form -->
	<form action="" method="post">
	{% csrf_token %}	
		<table>
			<tr>
				<td style="width:20%;">
					<b>Start a new thread:</b>
				</td>
				<td style="width:60%;">
					{{ form.title }} {{ form.title.errors }}
				</td>
				<td style="width:20%;">
					<input style="vertical-align: middle;" type="submit" value="Submit"/>
				</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td>Title must be non-empty and must not contain special characters.</td>
				<td>&nbsp;</td>
			</tr>
			<tr>
				<td>&nbsp;</td>
				<td>{{ form.is_private }} This thread is private (can only be viewed by project members)</td>
				<td>&nbsp;</td>
			</tr>
		</table>
	</form>
	

{% endblock %}