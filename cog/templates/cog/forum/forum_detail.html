{% extends "cog/common/layout_sidebar_center.html" %}

{% block main %}

    {% load comments %}
    {% load pagination_tags %}
    {% autopaginate topics 10 %}
    {% load cog_utils %}
    
    <!-- table of forum topics/threads -->
    <div class="mybox">
	    <table>
	        <caption>Topics</caption>
    
    		<!-- loop over forum topics -->
    		{% for topic in topics %}
    			<tr>
    				<td>
    					{{ topic|is_locked:request }} <a href="{% url 'topic_detail' project.short_name topic.id %}"><b>{{ topic.title }}</b></a>
    					
    					{% if user|hasAdminPermission:project %}
						    <span style="float:right">
							    <a href="{% url 'topic_update' project.short_name.lower topic.id %}" class="changelink">&nbsp;Update Topic</a>
							    &nbsp;
							    <a href="{% url 'topic_delete' project.short_name.lower topic.id %}" class="deletelink"
							        onclick="return urlConfirmationDialog('Delete Forum Topic Confirmation',
							                                              'Are you sure you want to delete this forum topic (including all its threads and posts) ?',this)">
							    &nbsp;Delete Topic?</a>
							</span>
						{% endif %}
    					
    				</td>
    			</tr>
    			<tr>
    				<td>
						{% for thread in topic.get_threads %}
							{{ thread.title }}
						{% empty %}
							<i>This topic has no threads yet.</i>
						{% endfor %}
						<br/>
    				</td>
    			</tr>
    		{% empty %}
    			<tr>
    				<td><i>No topics found.</i></td>
    			</tr>
    		{% endfor %}
    
		</table>
	</div>

	{% paginate %}
		
	<!-- new forum topic form -->
	{% if user|hasAdminPermission:project %}
		&nbsp;
		<hr/>
	  	<form action="" method="post">
		    {% csrf_token %}	
			<table>
				<tr>
					<td nowrap="nowrap">
						<span style="vertical-align: middle">Start a new <b>Topic</b>:</span>
					</td>
					<td class="long">
						<span style="vertical-align: middle">
							{{ form.title }} 
							<br/>{{ form.title.errors }}
							{{ form.is_private }} This topic is private (can only be viewed by project members)
							&nbsp;<input type="submit" value="Submit"/>
						</span>
					</td>
				</tr>
			</table>
	  	</form>
	  	Forum topics can only be created by project administrators. 
		The topic title must be non empty and must not contain special characters.
	{% endif %}
	
	<!-- anchor for delete confirmation dialog -->
	<div id="myDialog" class="yui-skin-sam"></div>
	
{% endblock %}