{% extends "cog/common/layout_sidebar_center.html" %}

{% block main %}

    {% load comments %}
    {% load pagination_tags %}
    {% autopaginate topics 10 %}
    {% load cog_utils %}
    
    <!-- one table per topic -->
    {% for topic in topics %}
   		<div class="mybox">
	    	<table>
	        	<caption>
	        		{{ topic|is_locked:request }} <a href="{% url 'topic_detail' project.short_name topic.id %}"><b>{{ topic.title }}</b></a>		 			
	        	</caption>
    			<!-- one row per thread -->
    			{% for thread in topic.get_threads %}
    				{% get_comment_count for thread as comment_count %}
					<tr>
						<td>
							<a href="{% url 'thread_detail' project.short_name thread.id %}">{{ thread.title }}</a>
							<br/>
	    					Started by {{ thread.author }} on {{ thread.create_date }}, {{ comment_count }} comments.
		    				{% if comment_count > 0 %}
		    					Last comment on {{ thread.get_last_comment.submit_date }} by {{ thread.get_last_comment.user }}.
		    				{% endif %}							
						</td>
					</tr>
    			{% empty %}
    				<tr>
    					<td>
    						<i>This topic has no threads yet.</i>
    					</td>
    				</tr>
    			{% endfor %}
    			
    			
    		</table>
    	</div>
    {% empty %}
    	<i>This forum has no topics yet.</i>
    {% endfor %}
    
	{% paginate %}
		
	<!-- new forum topic form -->
	{% if user|hasAdminPermission:project %}
		&nbsp;
		<hr/>
	  	<form action="" method="post">
		    {% csrf_token %}	
			<table>
				<tr>
					<td nowrap="nowrap">
						<span style="vertical-align: middle">Start a new <b>Topic</b>:</span>
					</td>
					<td class="long">
						<span style="vertical-align: middle">
							{{ form.title }} 
							<br/>{{ form.title.errors }}
							{{ form.is_private }} This topic is private (can only be viewed by project members)
							&nbsp;<input type="submit" value="Submit"/>
						</span>
					</td>
				</tr>
			</table>
	  	</form>
	  	Forum topics can only be created by project administrators. 
		The topic title must be non empty and must not contain special characters.
	{% endif %}
	
	
{% endblock %}