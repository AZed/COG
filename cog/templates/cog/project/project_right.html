
{% block right %}
    
    <!-- create and display tree -->
    <script>
    
       // map of (tree identifier, tree object) pairs
       var trees = {};
      
       // function to initialize a single tree object
       function treeInit() {
    	   treeId = this.id
	       tree = new YAHOO.widget.TreeView(document.getElementById(treeId));
	       tree.subscribe('clickEvent',tree.onEventToggleHighlight);  
	       //tree.setNodesProperty('propagateHighlightUp',true); 
	       tree.setNodesProperty('propagateHighlightDown',true); 
	       //tree.singleNodeHighlight = true; 
	       tree.render();
	       trees[treeId] = tree
       }
       
       // render tree when the page loads
       //YAHOO.util.Event.addListener(window, "load", treeInit); 
       // render tree as soon as the enclosing element is available, to reduce flicker
       //YAHOO.util.Event.onContentReady("treeDiv1", treeInit, this);
       //YAHOO.util.Event.onContentReady("treeDiv2", treeInit, this);
       
   </script>
   
   <script>
   
    function add_news() {
    	
        // news submission form (one per page, for all projects)    	
    	form = document.getElementById("treeForm");
        
        // keep track of all projects notified, to avoid double entries
        projects = {"{{ project.short_name }}":1}
    	
    	// loop over all project trees
    	for (var key in trees) {
    	
    		var _projects = trees[key].getNodesByProperty('highlightState',1); 
	    	if (!YAHOO.lang.isNull(_projects)) {  
	    	  // loop over selected projects
	    	  for (var i=0; i<_projects.length; i++) {
	    		 // extract the content of the <a>...</a> tag
	    		 var text = _projects[i].html.match(/<a .*>(.*)<\/a>/);
	    		 var projectName = RegExp.$1;
	    		 // insert project if not done already
	    		 if (projects[projectName]==null) {
	    			    var el=document.createElement('input');
	    			    el.type="hidden";
	    			    el.name = "other_projects";
	    			    el.value = projectName;
	    			    form.appendChild(el);
	    			    projects[projectName] = 1;
	    		 }
	    	  } 
	    	}
    	
        }
    	
    	// submit form
    	form.submit();
    }
   
   </script>
  
   <!--  FIXME -->
   <!-- CSS classes to display node type icons 
   <style type="text/css"> 
      .this { height: 16px; padding-left: 18px; margin: 4px; background: transparent url({{MEDIA_URL}}cog/img/tick.png) 0 0px no-repeat; font-weight: bold; } 
      .parent { height: 16px; padding-left: 18px; margin: 4px; background: transparent url({{MEDIA_URL}}cog/img/up_left2.png) 0 0px no-repeat; } 
      .peer { height: 16px; padding-left: 18px; margin: 4px; background: transparent url({{MEDIA_URL}}cog/img/right1.png) 0 0px no-repeat; } 
      .child { height: 16px; padding-left: 18px; margin:4px; background: transparent url({{MEDIA_URL}}cog/img/down_right2.png) 0 0px no-repeat; } 
   </style> -->
   <style type="text/css"> 
      .this { height: 16px; padding-left: 2px; margin: 4px; font-weight: bold; font-size: 8pt; } 
      .parent { height: 16px; padding-left: 2px; margin: 4px; font-size: 8pt;  } 
      .peer { height: 16px; padding-left: 2px; margin: 4px; font-size: 8pt;  } 
      .child { height: 16px; padding-left: 2px; margin:4px; font-size: 8pt; } 
   </style>  
   
   <style type="text/css">
   
    .projects_footer {
	    margin: 0px;
	    padding: 2px 5px 3px 5px;
	    font-size: 8pt;
	    text-align: left;
	    font-weight: bold;    
	    /* COG STYLE: PROJECTS FOOTER BACKGROUND COLOR */
	    background-color: #FCE79F;
	    /* background: #7CA0C7 url(../../img/admin/default-bg.gif) top left repeat-x; */
	    color: #666666;
	    /* COG STYLE: PROJECTS FOOTER BORDER COLOR */
	    border: 0px;
	    border-top: 1px solid #666666;
	    display: block;
	}
	
	.project_widget {
	    margin: 0px;
	    padding: 0px;
	    font-size: 8pt;
	    text-align: left;
	    font-weight: bold;
	    background-color: #FFFFFF;
	    border: 1px solid #666666;
	    color: #666;
	    display: block;
	}
	
	.tabs_caption {
	    margin: 0px;
	    padding: 2px 5px 3px 5px;
	    font-size: 8pt;
	    text-align: left;
	    font-weight: bold;
	    background-color: #FCE79F;
	    color: #666;
	    display: block;
	}
	
	.project_widget table td {
	    /* important: must align project labels with middle of checkbox */ 
		vertical-align: middle;
	}
	
   </style>
   
   <link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}css/yui/tabview.css" />     
   
  <!-- COG custom filters --> 
  {% load cog_utils %}
  {% load url from future %}
    
  <!-- text search form -->
  <div class="search-box">
       <div class="search_header">Data Search</div>
       <div style="width:100%; padding:4px;">
	       <form action='{% url 'search' project.short_name.lower %}' method="post" id="search-form">
	            {% csrf_token %} 
	            <!-- <input type="hidden" name="offset" value="0" /> -->
	            <!-- <input type="hidden" name="limit" value="10" /> -->
	            <input type="hidden" name="type" value="Dataset" />	                
                <input type="text" name="text" size="24" value="" style="width:75%"/>&nbsp;<input type="submit" value="Go"/>
                <!--  <select name="type">
                    <option value="Dataset">Data</option>
                    <option value="Model">Models</option>
                    <option value="Document">Documents</option>
                </select> -->		            
	       </form>
       <a href="{% url 'search' project.short_name.lower %}" class="listlink">&nbsp; &nbsp;Advanced Data Search</a>
       </div>
  </div>
  <p/>
  
   <!-- Project Connections -->
   <div class="yui-skin-sam">     
     <div class="project_widget">
     
       <div id="project_views" class="yui-navset">  
          <div class="tabs_caption">Project Views</div>  
          <ul class="yui-nav">
              <li class="selected">&nbsp;&nbsp;<a href="#tab1"><em>This</em></a>&nbsp;&nbsp;</li>
              <li>&nbsp;&nbsp;<a href="#tab2"><em>All</em></a>&nbsp;&nbsp;</li>
              <li>&nbsp;&nbsp;<a href="#tab3"><em>My</em></a>&nbsp;&nbsp;</li>
          </ul>  
          <div class="yui-content">
              <div>{{ request.user|tree_this_project:project }}</div>
              <div>{{ request.user|tree_all_projects }}</div>
              <div>{{ request.user|tree_my_projects }}</div>
          </div>
       </div>                
      
	   <!-- News submission form -->
	   {% if user|hasUserPermission:project %}
	     	<!-- news submission form - one per page, for all project trees -->
		    <form name="treeForm" id="treeForm" method="GET" action="{% url 'news_add' project.short_name %}" />
	     
	     	<div class="projects_footer">
	           &nbsp;<a href="javascript:add_news()" class="addlink"> <span style="font-size:7pt">Publish {{ project.short_name }} News &raquo;</span></a>
	     	</div>
	   {% endif %}
     
      </div>
    </div>       

    <script>var myTabs = new YAHOO.widget.TabView("project_views");</script>
   
    <p/>
   
    <!-- include project latest news, if available -->
    {% include 'cog/project/_project_latest_news.html' %}
   
{% endblock %}