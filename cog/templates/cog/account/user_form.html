<!-- Template page used to create a user account -->
<!--LOCATION: /cog/templates/cog/account/user_form.html-->
{% extends "cog/common/layout_center.html" %}

{% load cog_utils %}

{% block extrahead %}

	<!--<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.9.0/build/fonts/fonts-min.css"/>-->
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.9.0/build/autocomplete/assets/skins/sam/autocomplete.css" />
	<script type="text/javascript" src="http://yui.yahooapis.com/2.9.0/build/yahoo-dom-event/yahoo-dom-event.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.9.0/build/animation/animation-min.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.9.0/build/datasource/datasource-min.js"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/2.9.0/build/autocomplete/autocomplete-min.js"></script>

    <!-- note: must style the autocomplete containers otherwise it expands to fit the whole window-->
    <style scoped type="text/css">
        #countryAutoComplete {
            width:300px;
            padding-bottom: 8px;
        }
        #stateAutoComplete {
            width:300px;
            padding-bottom: 8px;
        }
    </style>
     <!--[if IE 9 ]> <html class="ie9"> <![endif]-->
     <!-- loading CoG-specific styles. Needs to be last -->
     <link rel="stylesheet" type="text/css" href="{{STATIC_URL}}cog/css/cogstyle.css" />

    {% include 'cog/account/_countries.html' %}
    {% include 'cog/account/_states.html' %}

    <script>
    //<![CDATA[

       function init() {
    	   // country
           var countryDataSource = new YAHOO.util.LocalDataSource(countryArray);
           var countryAutoComp = new YAHOO.widget.AutoComplete("id_country", "countryContainer", countryDataSource);
           countryAutoComp.prehighlightClassName = "yui-ac-prehighlight";
           countryAutoComp.useShadow = true;
           countryAutoComp.allowBrowserAutocomplete = false;
           // state
           var stateDataSource = new YAHOO.util.LocalDataSource(stateArray);
           var stateAutoComp = new YAHOO.widget.AutoComplete("id_state", "stateContainer", stateDataSource);
           stateAutoComp.prehighlightClassName = "yui-ac-prehighlight";
           stateAutoComp.useShadow = true;
           stateAutoComp.allowBrowserAutocomplete = false;
       }
       YAHOO.util.Event.onContentReady("userDiv", init);

    //]]>
    </script>

{% endblock %}

{% block main %}
<!--why is this not span-24? Going across the entire page?-->
<!--<div class="prepend-3 span-18">-->
  <div class="prepend-1 span-22">

    <h2>{{ mytitle }}</h2>
    <p>Required fields are in <b>bold</b>. The following characters are not allowed: &lt; &gt; &amp; # % { } [ ] $ </p>

    <!-- display extra message if available -->
	{% if request.GET.message %}
	   <div class="message-box"> {{ request.GET.message|showMessage }}</div>
	   <p/>
	{% endif %}


    <div class="yui-skin-sam">
	    <div class="mybox" id="userDiv">

	        <form action="" method="post" enctype="multipart/form-data">

	            {% csrf_token %}
	            {{ formset1.management_form }}
	            {{ formset2.management_form }}
	           <!--width specified for IE, which does not accept
	            width=99% as listed in the CSS for long-->

	            <table>
	                <tr>
	                    <td class="required" nowrap="nowrap">First Name</td>
	                    <td>{{ form.first_name }} {{ form.first_name.errors }}</td>
	                </tr>
	                <tr>
	                    <td class="required" nowrap="nowrap">Last Name</td>
	                    <td >{{ form.last_name }} {{ form.last_name.errors }}</td>
	                </tr>
	                <tr>
	                    <td class="required" nowrap="nowrap">Email</td>
	                    <td>{{ form.email }} {{ form.email.errors }}</td>
	                </tr>
	                <tr>
	                    <td class="required" nowrap="nowrap">User Name</td>
	                    <td>{{ form.username }}
	                        <i>[ 5 to 30 characters, letters, digits and @/./+/-/_ only ]</i><br/>{{ form.username.errors }}
	                    </td>
	                </tr>

	                <!-- existing COG users: the encrypted passwords are resubmitted as hidden fields -->
	                {% if form.instance.id %}

	                	{% if form.instance.profile.isCogUser %}
			            	<!-- existing user: include encoded password, confirm_password as hidden fields -->
		                	{{ form.password.as_hidden }}
		                    {{ form.confirm_password.as_hidden }}
	                    {% endif %}

	                <!-- new users: must submit a password, confirm password -->
	                {% else %}
		                <!-- otherwise, the user must submit a password -->
		                <tr>
		                    <td class="required" nowrap="nowrap">Password</td>
		                    <td>{{ form.password }}
		                       <i>[ At least 6 characters, all characters are allowed ]</i>
		                       <br/>{{ form.password.errors }}
		                       </td>
		                </tr>
		                <tr>
		                    <td class="required" nowrap="nowrap">Confirm Password</td>
		                    <td>{{ form.confirm_password }}
		                        <i>[ At least 6 characters, all characters are allowed ]</i>
		                        <br/>{{ form.confirm_password.errors }}
		                    </td>
		                </tr>
	                {% endif %}
	                <tr>
                        <td class="required" nowrap="nowrap">Institution</td>
                        <td>{{ form.institution }} {{ form.institution.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Department</td>
                        <td class="long">{{ form.department }} {{ form.department.errors }}</td>
                    </tr>
                    <tr>
                        <td class="required" nowrap="nowrap">City</td>
                        <td class="long">{{ form.city }} {{ form.city.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">State</td>
                        <td>
                            <div id="stateAutoComplete">
                            {{ form.state }} <div id="stateContainer"></div></div><br/> {{ form.state.errors }}
                        </td>
                    </tr>
                    <tr>
                        <td class="required" nowrap="nowrap">Country</td>
                        <td>
                            <div id="countryAutoComplete">
                            {{ form.country }} <div id="countryContainer"></div></div><br/> {{ form.country.errors }}
                        </td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Interest Keywords</td>
                        <td>
                        A short list of science fields you are involved with (60 characters maximum).
                        <br/>Example: Software Engineering, Grid Computing, Climate Change.
                        <br/>{{ form.researchKeywords }} {{ form.researchKeywords.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Interest Statement</td>
                        <td>
                        A short paragraph describing your professional interests (1000 characters maximum).
                        <br/>{{ form.researchInterests }} {{ form.researchInterests.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Subscribe to COG Email List ?</td>
                        <td>{{ form.subscribed }} <i>[ 'cog_info', low traffic list ]</i> {{ form.subscribed.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Do not list me among project members</td>
                        <td>{{ form.private }} {{ form.private.errors }}</td>
                    </tr>
                    <tr>
                        <td class="optional" nowrap="nowrap">Picture
                        <br/>(Maximum Size: 1MB)
                        <br/>(Format: 'jpg', 'png', or 'gif')
                        </td>
                        <td>
                        <table>
                        	<tr>
                        	<td>
                        	<img src="{{ form.instance|getImage }}" {% if not 'unknown' in form.instance|getImage %} class="myimage" {% endif %}/>
                        	</td>
                        	<td align="left">
			              <div style="margin-top:2px">
			                  {% if not 'unknown' in form.instance|getImage %}
			                      {{ form.delete_image }} Delete current picture ?
			                  {% endif %}
			                  <br/>
			                  {{ form.image }}
			                  &nbsp;{{ form.image.errors }}
			               </div>
                                  </td>
                        	</tr>
                        </table>
                        </td>
                        </tr>
              </table>


              <table>
             		<!-- OpenIDs: NOT for new accounts (since an OpenID is generated automatically) -->
              		{% if form.instance.id %}
              			<tr>
              			<td colspan="3">Optional ESGF OpenID(s) associated with this COG user account:</td>
              			</tr>
	                    {% for openidform in formset2 %}
			       	{{ openidform.id }}
				<!--// inline styles needed to override default table //-->
				<tr>
				<td style="width:80px;vertical-align:middle;"><b>OpenID URL:</b></td>
				<td style="width:500px;vertical-align:middle;">{{ openidform.claimed_id }} {{ openidform.claimed_id.errors }}</td>
				<td style="vertical-align:middle;">{{openidform.DELETE }} Delete ? </td>
                                </tr>
			    {% endfor %}
		    	{% endif %}
             </table>
	     <!--this section is its own table in order to make the td
             		widths different from the one above-->
	     <table class="odd-color">
				
		    	<!-- URLs -->
		    		<tr>
              			<td colspan="6">Optional web sites associated with this COG user account:('Home Page', 'My Blog', ...)</td>
              		        </tr>
                                 {% for urlform in formset1 %}{{ urlform.id }}
				 <tr>
			           <td style="width:60px;vertical-align:middle;"><b>Web URL:</b></td>
				   <td style="width:300px;vertical-align:middle;">{{ urlform.url }} {{ urlform.url.errors }}</td>
			           <td style="width:30px;vertical-align:middle;"><b>Title:</b></td>
				   <td style="width:200px;vertical-align:middle;">{{ urlform.name }} {{ urlform.name.errors }}</td>
			           <td style="vertical-align:middle;">{{ urlform.DELETE }} Delete ?</td>
				  </tr>
		    	 	 {% endfor %}
 	            </table>

	            <div style="text-align:right;">
	                <hr/>
	                {% if request.user.is_anonymous %}
	                   <input type="button" value="Cancel" onclick="window.location='{% url 'site_index' %}'"/>
	                {% else %}
	                   <!-- prevent user with non-complete data to hit 'cancel' button -->
	                   {% if request.user|isValidUser %}
	                   <input type="button" value="Cancel" onclick="window.location='{% url 'user_detail' form.instance.id %}'"/>
	                   {% endif %}
	                {% endif %}
	                <input type="submit" value="Submit" />
	            </div>

	        </form>
	    </div>
    </div>
</div>

{% endblock %}