{% load cog_utils %}
{% load search_utils %}

{% if request.GET.search_data %}

  <!-- anchor for dialogs -->
  <div id="myDialog" class="yui-skin-sam"></div>

  <!-- don't display results if form submission resulted in error -->
  {% if not error_message %}

    {% with search_output.results as results %}
                     
        {% if results|length == 0 %}
            <p/><div style="text-align:center; font-weight:bold">The search returned 0 results.</div>
        {% else %}
        
            <p/>
            <div style="text-align:center">
	            Total Number of Results: {{ search_output.counts }} 
	            <br/>
				{% for page in search_pages %}
					{% if page.1 == search_input.offset %}
						{{ page.0 }} <!-- current page, no hyperlink -->
					{% else %}
						<a href="{% url 'search' project.short_name.lower %}" onclick="javascript:searchit({{ page.1 }}); return false;">{{ page.0 }}</a>
					{% endif %}
				{% endfor %}
			</div>
			&nbsp;<br/>
                                           
	        <div class="mybox">
	            
	            <!-- Table of search results -->
	            <table>
	            
	                {% for record in results %}         
	                    <tr>
	                        <td class="tophead">{{ search_input.offset|add:forloop.counter }}.</td>
	                        <td class="long">
	                        
	                        	<!-- dataset metadata container -->
	                            {% with record as record %}
									{% include 'cog/search/_record_display.html' %}	
								{% endwith %}
	                        		                           	               
	                           	{% if request.user.is_authenticated %}
	                           		<br/>
	                           		
	                           		<!-- link to Data Cart -->
									<a href="javascript:addToCart('{{ record.id }}', '{{ record.fields.title.0 }}', '{{ record.fields.type.0 }}', '{{ record|toJson }}')">
										<img src="{{STATIC_URL}}cog/img/datacart-add.png" height="20px" style="vertical-align:middle; padding-right:2px; padding-bottom:4px;">Add to Data Cart</img>
									</a>	    
									&nbsp;         
									                	
		                           	<!-- link to Resources -->             	                               
		                            {% if user|hasUserPermission:project %}
		                                          	                        	
			                        	<!-- loop over URls, use THREDDS catalog URL -->
			                        	{% for url in record.fields.url %}
			                        		{% if url.1 == 'application/html+thredds' %}	  	                               
	                                   			<a href="javascript:bookmarkit('{{url.0}}', '{{record.fields.title.0}}')">
	                                      			<img src="{{STATIC_URL}}cog/img/bookmark_add2.png" height="20px" style="vertical-align:middle; padding-right:2px; padding-bottom:4px;">Save to Resources</img>
	                                   			</a>	  
			                            	{% endif %} 
			                            {% endfor %}    	          	                               
	                                {% endif %}
                                
                                {% endif %}
                                <br/>
	                            	                            
	                        </td>
	                    </tr>       
	                {% endfor %}
	            
	            </table>
	            
	        </div>
        {% endif %}
        
        
    {% endwith %}
  {% endif %}

{% endif %}