COG WEB PORTAL INSTALLATION INSTRUCTIONS

The following instructions describe how to quickly install the CoG environment on a Unix-type server (Cent-OS, Linux, Mac-OSX)
for the purpose of starting to use and test the web application. In a production environment, the CoG should really be front-ended
by a separately installed Apache httpd server (not covered here).

PRE-REQUISITES

The system must have the following Python packages installed:

o Python 2.7.2+

o Django 1.5.2+
  easy_install --upgrade django

o Django Grappelli
  easy_install --upgrade django-grappelli

o Django pagination:
  easy_install --upgrade django-pagination

o South
  easy_install --upgrade south

o Python Image Library
  easy_install --upgrade pil
  
o Python posgres libraries
  sudo pip install pyscopg2
  
Note: CoG also depends on Django Filebrowser, but this application is shipped as part of the CoG source code because it had to be manually modified.

DOWNLOAD

Download the software from the SVN repository:

cd <install directory>
git clone git@github.com:EarthSystemCoG/COG.git
cd COG

DATABASE CONFIGURATION

o Install latest version of Postgres

o To run with a postgres database back-end (default), create a database 'cogdb' and a username, password to be access that database:

createdb -U postgres cogdb
createuser -U postgres -P
        - username: <your username>
        - password: <your password>
(answer "n" to all other questions)

psql -U postgres --password
password: <your postgres superuser password>

postgres=#  GRANT ALL PRIVILEGES ON DATABASE cogdb TO cogdbadmin;
GRANT
postgres=# FLUSH
postgres-# \q

COG CONFIGURATION

o Create a file called ~/.cog_settings.cfg in the directory /usr/local/cog, or in any other directory referenced by the env variable
COG_CONFIG_DIR
The file must have the following content, with values replaced by the installation specific settings:

cat .cog_settings.cfg

SITE_ID=<the site specific id, an integre number. Must be coordinated with other federated CoG installations>
TIME_ZONE=<"America/Denver by default". See list of Django values for time zones>
COG_MAILING_LIST=<"cog_info@list.woc.noaa.gov" by default. Mailing list where users subscribe to>
SECRET_KEY=<the site specific key: an arbitrary string with lots of strange characters>
DATABASE_USER=<username to access cogdb postgres database>
DATABASE_PASSWORD=<password to access cogdb postgres database>
DATABASE_PORT=<port used by postgres database>


INITIALIZATION

o python manage.py syncdb (initializes tables for all applications except 'CoG')

o python manage.py migrate cog (initializes and migrates tables for 'CoG' application)

o gather the static media files from the different applications into a single directory

mkdir static
python manage.py collectstatic


STARTUP

o Start the CoG application within the embedded Django development server:
python manage.py runserver

By default, the Django server is available on port 8000


USAGE AND TESTING

o Access the application home page at:
http://localhost:8000/

Please note that none of the project links contained in the right column will work because those projects do NOT exist in the local database.

o By default, the CoG database is configured with one single project called 'Test'. Access the 'Test' project home page by visiting the following URL:

http://localhost:8000/projects/test/

o Login as the site administrator by clicking the 'Login' hyperlink in the upper right of the page, and login with the following username/password:

Username: changeme
Password: changeme

IMPORTANT: immediately change the administrator username and password by clicking on the upper right link 'Django Admin', 
which will show the Django Administrator web interface. Further click on 'Users', then 'changeme_user', 
then start changing the administraror's profile.

o Start experimenting with creating new projects and registering new users.

FURTHER CONFIGURATION

o CKEDITOR
By default, the wiki pages (including any project home page) are editable through a simple text area widget. 
CoG can be easily configured to allow editing via the third-party CKEditor, which includes a WYSIWYG interface:

Download the CKEditor version 3.6.4 and expand it to:
<installation directory>/COG/cog/static/cog/ckeditor

(NOTE: when running with an Apache httpd server, the CKEditor code must be located under: <installation directory>/COG/static/cog/ckeditor


o EMAIL notifiication
To enable email notification for project membership, create a file in the directory COG_CONFIG_DIR
with name .cog.cfg and the following content:

[email]
email.server=<your email server hostname>
email.username=<email server username>
email.password=<email server password>

For example, on the NOAA server:

[apache@hydra ~]$ cat ~apache/.cog.cfg
[email]
email.server=dmzmail.fsl.noaa.gov
# leave port blank if default
email.port=
email.sender=earthsystemcog@noaa.gov
email.username=
email.password=
email.security=

o SSL SUPPORT

To run CoG with SSL encryption, the following actions must be taken:

- procure an SSL certificate, possibly from a recognized CA
- modify the Apache httpd configuration file to redirect all requests on port 80 to port 443. Example configuration follows:

LoadModule ssl_module modules/mod_ssl.so

<VirtualHost 172.24.254.127:80>
  ServerName dev-hydra-httpd.esrl.svc
  Redirect / https://dev-hydra-httpd.esrl.svc/
</VirtualHost>

<VirtualHost 172.24.254.127:443>
  ServerName dev-hydra-httpd.esrl.svc

  SLEngine on
  SSLCertificateFile /etc/httpd/conf/httpd.cert
  SSLCertificateKeyFile /etc/httpd/conf/httpd.key
  SetEnv SERVER_TYPE PROD

Note: the last instruction on SERVER_TYPE is used in settings.py to enable cookies only for secure requests:
it will prevent logging in from a non-secure HTTP request.